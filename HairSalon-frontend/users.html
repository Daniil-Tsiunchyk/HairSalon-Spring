<!DOCTYPE html>
<html>

<head>
    <title>Управление пользователями</title>
</head>

<body>
    <header>
        <nav>
            <ul>
                <li><a href="users.html">Пользователи</a></li>
                <li><a href="services.html">Услуги</a></li>
                <li><a href="discount-cards.html">Дисконтные карты</a></li>
                <li><a href="bookings.html">Брони</a></li>
                <li><a href="logout.html">Выход</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <h1>Управление пользователями</h1>

        <form id="createUserForm">
            <label for="createUsername">Имя пользователя:</label>
            <input type="text" id="createUsername" name="username" required><br>

            <label for="createPassword">Пароль:</label>
            <input type="password" id="createPassword" name="password" required><br>

            <label for="createFirstName">Имя:</label>
            <input type="text" id="createFirstName" name="firstName"><br>

            <label for="createLastName">Фамилия:</label>
            <input type="text" id="createLastName" name="lastName"><br>

            <button type="submit">Создать</button>
        </form>

        <table id="userTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Имя пользователя</th>
                    <th>Имя</th>
                    <th>Фамилия</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </main>

    <footer>
        Шерлок Холмс раскрывал некоторые дела "за одну выкуренную трубку", это окно сделано за одну выпитую кружку кофе.
    </footer>

    <div id="deleteUserModal" style="display: none;">
        <p>Вы уверены, что хотите удалить этого пользователя?</p>
        <button id="confirmDeleteUser">Да</button>
        <button id="cancelDeleteUser">Отмена</button>
    </div>

    <script>
        function showDeleteUserModal(userId) {
            const modal = document.getElementById("deleteUserModal");
            const confirmButton = document.getElementById("confirmDeleteUser");
            const cancelButton = document.getElementById("cancelDeleteUser");

            confirmButton.onclick = function () {
                modal.style.display = "none";
                deleteUser(userId);
            };

            cancelButton.onclick = function () {
                modal.style.display = "none";
            };

            modal.style.display = "block";
        }

        function updateTable() {
            fetch("http://localhost:8080/api/users")
                .then((response) => response.json())
                .then((data) => {
                    const tableBody = document.querySelector("#userTable tbody");
                    tableBody.innerHTML = "";

                    data.forEach((user) => {
                        const row = document.createElement("tr");
                        row.innerHTML = `
                          <td>${user.id}</td>
                          <td>${user.username}</td>
                          <td>${user.firstName}</td>
                          <td>${user.lastName}</td>
                          <td>
                              <button onclick="editUser(${user.id})">Редактировать</button>
                              <button onclick="showDeleteUserModal(${user.id})">Удалить</button>
                          </td>
                      `;

                        tableBody.appendChild(row);
                    });
                });
        }

        document
            .getElementById("createUserForm")
            .addEventListener("submit", function (event) {
                event.preventDefault();
                const username = document.getElementById("createUsername").value;
                const password = document.getElementById("createPassword").value;
                const firstName = document.getElementById("createFirstName").value;
                const lastName = document.getElementById("createLastName").value;

                fetch("http://localhost:8080/api/users", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ username, password, firstName, lastName }),
                }).then((response) => {
                    if (response.status === 201) {
                        updateTable();
                        document.getElementById("createUsername").value = "";
                        document.getElementById("createPassword").value = "";
                        document.getElementById("createFirstName").value = "";
                        document.getElementById("createLastName").value = "";
                    }
                });
            });

        function editUser(userId) {
            //Добавить модальное окно
        }

        function deleteUser(userId) {
            fetch(`http://localhost:8080/api/users/${userId}`, {
                method: "DELETE",
            }).then((response) => {
                if (response.status === 204) {
                    updateTable();
                }
            });
        }

        updateTable();
    </script>

</body>

</html>